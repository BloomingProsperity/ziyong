# Web Scraping Agent Skills

---
name: web-scraping-agent
version: 3.1.0
description: 模块化智能爬虫技能包（专家级）
author: Unified Agent Team
license: MIT
---

## 架构总览

```
unified_agent/
├── SKILLS.md                    # 本文件：总入口
├── skills/
│   ├── 00-quick-start.md        # 快速开始：新手引导与资源规划
│   ├── 01-reconnaissance.md     # 侦查模块：信息收集与分析
│   ├── 02-anti-detection.md     # 反检测模块：指纹伪装与绕过
│   ├── 03-signature.md          # 签名模块：加密参数破解
│   ├── 04-request.md            # 请求模块：HTTP客户端与重试
│   ├── 05-parsing.md            # 解析模块：数据提取与清洗
│   ├── 06-storage.md            # 存储模块：持久化与导出
│   ├── 07-scheduling.md         # 调度模块：并发与限流
│   ├── 08-diagnosis.md          # 诊断模块：日志分析与自动修复
│   ├── 09-js-reverse.md         # JS逆向模块：深度逆向工程
│   ├── 10-captcha.md            # 验证码模块：识别与绕过
│   ├── 11-fingerprint.md        # 指纹工厂：浏览器指纹生成
│   ├── 12-mobile.md             # 移动端模块：APP抓包与逆向
│   ├── 13-distributed.md        # 分布式模块：集群架构
│   ├── 14-monitoring.md         # 监控模块：告警与可视化
│   ├── 15-compliance.md         # 数据安全：PII脱敏与密钥管理
│   ├── 16-tactics.md            # 战术模块：入口发现与策略切换
│   ├── 17-feedback-loop.md      # 反馈模块：学习、验证、自进化
│   ├── 18-brain-controller.md   # 决策总控：任务分发与执行协调
│   ├── 19-fault-decision-tree.md# 故障决策树：异常处理路径
│   ├── 20-e2e-cases.md          # 端到端案例：完整实战指南
│   ├── 21-anti-patterns.md      # 反面教材：常见错误与禁止行为
│   ├── 22-knowledge-format.md   # 知识格式：经验沉淀规范
│   ├── 23-mcp-protocol.md       # MCP协议：对外工具接口
│   ├── 24-credential-pool.md    # 凭据池：账号会话管理
│   ├── 25-data-schema.md        # 数据Schema：质量与落库
│   └── 26-testing-regression.md # 测试回归：基准与门禁
├── brain.py                     # 统一入口
├── collector.py                 # 信息收集器
├── smart_analyzer.py            # 智能分析器
├── agent.py                     # 抓取代理
├── stealth.py                   # 反检测
├── proxy.py                     # 代理管理
├── config.py                    # 配置
└── presets.py                   # 预设配置
```

---

## 模块索引

### 基础模块

| 模块 | 职责 | 核心类/函数 | 难度 |
|------|------|------------|------|
| [🚀 快速开始](skills/00-quick-start.md) | 新手引导、资源评估、配置建议 | `ResourceAssessment` | ⭐ |
| [侦查模块](skills/01-reconnaissance.md) | 目标分析、请求捕获、特征识别 | `InfoCollector`, `SmartAnalyzer` | ⭐⭐ |
| [反检测模块](skills/02-anti-detection.md) | 指纹伪装、TLS绕过、行为模拟 | `stealth.py`, `StealthConfig` | ⭐⭐⭐ |
| [签名模块](skills/03-signature.md) | 参数分析、算法逆向、签名生成 | `SignatureAnalysis`, `crack_*` | ⭐⭐⭐⭐ |
| [请求模块](skills/04-request.md) | HTTP客户端、重试策略、代理轮换 | `call_api`, `RetryConfig` | ⭐⭐ |
| [解析模块](skills/05-parsing.md) | DOM提取、JSON解析、数据清洗 | `ScraperAgent`, `scrape_*` | ⭐⭐ |
| [存储模块](skills/06-storage.md) | 会话管理、数据导出、缓存 | `save_session`, `export_data` | ⭐ |
| [调度模块](skills/07-scheduling.md) | 任务队列、并发控制、限流 | `batch_call_api`, `Scheduler` | ⭐⭐ |
| [🔧 诊断模块](skills/08-diagnosis.md) | 日志分析、错误诊断、自动修复 | `Diagnoser`, `AutoFixer` | ⭐ |

### 高级模块

| 模块 | 职责 | 核心类/函数 | 难度 |
|------|------|------------|------|
| [🔬 JS逆向模块](skills/09-js-reverse.md) | AST分析、Webpack逆向、算法还原 | `ASTDeobfuscator`, `WebpackExtractor` | ⭐⭐⭐⭐⭐ |
| [🤖 验证码模块](skills/10-captcha.md) | 滑块/点选/图形验证码识别与绕过 | `SliderCracker`, `ClickCaptcha` | ⭐⭐⭐⭐ |
| [🎭 指纹工厂](skills/11-fingerprint.md) | 浏览器指纹生成、管理与注入 | `FingerprintGenerator`, `ProfileStorage` | ⭐⭐⭐⭐⭐ |
| [📱 移动端模块](skills/12-mobile.md) | APP抓包、Frida Hook、APK逆向 | `FridaHooker`, `APKAnalyzer` | ⭐⭐⭐⭐⭐ |
| [🌐 分布式模块](skills/13-distributed.md) | 集群架构、任务队列、负载均衡 | `MasterNode`, `WorkerNode` | ⭐⭐⭐⭐ |
| [📊 监控模块](skills/14-monitoring.md) | Prometheus指标、Grafana、告警 | `CrawlerMetrics`, `AlertManager` | ⭐⭐⭐ |
| [🔐 数据安全](skills/15-compliance.md) | PII脱敏、密钥管理、凭证轮换 | `PIIDetector`, `SecretManager`, `CredentialRotator` | ⭐⭐ |
| [🎯 战术决策](skills/16-tactics.md) | 入口发现、策略匹配、动态调整 | `EntryDiscovery`, `StrategySelector`, `TrapDetector` | ⭐⭐⭐⭐⭐ |

### 自主进化模块

| 模块 | 职责 | 核心类/函数 | 难度 |
|------|------|------------|------|
| [🔄 反馈循环](skills/17-feedback-loop.md) | 决策追踪、数据验证、经验学习 | `DecisionLogger`, `DataValidator`, `KnowledgeBase` | ⭐⭐⭐ |
| [🧠 决策总控](skills/18-brain-controller.md) | 任务理解、模块协调、执行编排 | `TaskAnalyzer`, `ModuleOrchestrator`, `StateManager` | ⭐⭐⭐⭐⭐ |
| [🚨 故障决策树](skills/19-fault-decision-tree.md) | 故障分类、决策路径、自动恢复 | `FaultDiagnoser`, `RecoveryExecutor`, `EscalationManager` | ⭐⭐⭐⭐ |
| [📚 端到端案例](skills/20-e2e-cases.md) | 完整实战指南、可复制方案 | `CaseLibrary`, `StepByStepGuide` | ⭐⭐ |
| [⛔ 反面教材](skills/21-anti-patterns.md) | 禁止行为、常见错误、失败案例 | `AntiPatternDetector`, `RedLineChecker` | ⭐⭐⭐ |
| [📝 知识格式](skills/22-knowledge-format.md) | 经验沉淀、知识检索、持续进化 | `KnowledgeSchema`, `KnowledgeQuery` | ⭐⭐⭐ |

### 基础设施模块

| 模块 | 职责 | 核心类/函数 | 难度 |
|------|------|------------|------|
| [🔌 MCP协议](skills/23-mcp-protocol.md) | 对外工具接口、安全边界 | `MCPServer`, `Tool`, `ToolResult` | ⭐⭐⭐ |
| [🔑 凭据池](skills/24-credential-pool.md) | 账号会话管理、轮换刷新 | `CredentialPool`, `SessionRefresher` | ⭐⭐⭐ |
| [📋 数据Schema](skills/25-data-schema.md) | 数据结构、校验去重、落库 | `DataSchema`, `DataValidator`, `Deduplicator` | ⭐⭐⭐ |
| [🧪 测试回归](skills/26-testing-regression.md) | 基准测试、回归门禁、红线 | `BenchmarkRunner`, `RegressionSuite`, `CIGate` | ⭐⭐⭐ |

---

## 工作流程

```
┌─────────────────────────────────────────────────────────────────────┐
│                          爬虫工作流                                  │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│   ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌──────────┐    │
│   │ 01 侦查  │───▶│ 02 伪装  │───▶│ 03 签名  │───▶│ 04 请求  │    │
│   │Reconnais│    │ Anti-Det │    │Signature │    │ Request  │    │
│   └──────────┘    └──────────┘    └──────────┘    └──────────┘    │
│        │                                               │           │
│        │  ┌─────────────────────────────────────────┐  │           │
│        │  │            07 调度 (Scheduling)          │  │           │
│        │  │         并发控制 / 任务队列 / 限流        │  │           │
│        │  └─────────────────────────────────────────┘  │           │
│        │                                               │           │
│        ▼                                               ▼           │
│   ┌──────────┐                                    ┌──────────┐    │
│   │ 分析结果 │                                    │ 响应数据 │    │
│   └────┬─────┘                                    └────┬─────┘    │
│        │                                               │           │
│        │         ┌──────────┐    ┌──────────┐         │           │
│        └────────▶│ 05 解析  │───▶│ 06 存储  │◀────────┘           │
│                  │ Parsing  │    │ Storage  │                     │
│                  └──────────┘    └──────────┘                     │
│                                                                     │
│   ┌─────────────────────────────────────────────────────────────┐  │
│   │                    08 诊断 (Diagnosis)                       │  │
│   │    出错时: 分析日志 → 识别原因 → 自动修复/给出方案 → 重试     │  │
│   └─────────────────────────────────────────────────────────────┘  │
│                                                                     │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 快速开始

```python
from unified_agent import Brain

brain = Brain()

# Step 1: 智能侦查 + 资源评估
analysis = brain.smart_investigate("https://example.com")

# Step 2: 查看报告（会告诉你需要什么资源）
print(analysis.to_ai_report())
# 报告会告诉你:
# - ✅ 是否需要代理
# - ✅ 是否需要登录
# - ✅ 推荐的请求频率
# - ✅ 预估成本

# Step 3: 根据建议配置后，开始抓取
result = brain.call_api(analysis.main_data_api["url"])     # 04 请求
data = brain.scrape_page(url)                               # 05 解析
brain.export_data(data, "output")                           # 06 存储
```

---

## 模块详情

点击下方链接查看各模块的详细文档：

### [00 - 快速开始](skills/00-quick-start.md) 🌟 新手必读
> 资源需求评估与配置建议

- **自动判断是否需要代理**
- **自动判断是否需要登录/多账号**
- 请求频率建议
- 成本预估
- 一键生成配置代码

### [01 - 侦查模块](skills/01-reconnaissance.md)
> 目标网站的信息收集与智能分析

- 网络请求捕获 (XHR/Fetch/WebSocket)
- Cookie/Header 收集
- 反爬等级评估
- API 端点发现
- 网站类型识别

### [02 - 反检测模块](skills/02-anti-detection.md)
> 绕过各类检测机制

- TLS/JA3 指纹伪装
- WebDriver 检测绕过
- Canvas/WebGL 指纹随机化
- 鼠标轨迹模拟
- 请求时序人类化

### [03 - 签名模块](skills/03-signature.md)
> 加密参数分析与破解

- 签名参数识别
- 算法特征分析
- 常见签名模式库 (h5st, mtop, X-Bogus...)
- 逆向工程方法论
- RPC/补环境方案

### [04 - 请求模块](skills/04-request.md)
> HTTP 请求发送与错误处理

- 多协议支持 (HTTP/1.1, HTTP/2)
- 智能重试 (指数退避)
- 代理池管理
- Cookie 自动管理
- 响应解析

### [05 - 解析模块](skills/05-parsing.md)
> 数据提取与结构化

- CSS 选择器提取
- XPath 提取
- 智能列表识别
- 分页处理
- 数据清洗

### [06 - 存储模块](skills/06-storage.md)
> 数据持久化与会话管理

- 多格式导出 (JSON/CSV/Excel)
- 会话保存/恢复
- 增量更新
- 去重策略

### [07 - 调度模块](skills/07-scheduling.md)
> 任务编排与流量控制

- 并发控制
- 请求限流
- 任务队列
- 失败重试队列
- 优先级调度

### [08 - 诊断模块](skills/08-diagnosis.md) 🔧 出问题时看这个
> 日志分析、错误诊断、自动修复

- **自动分析错误原因**
- **给出解决方案**
- **可自动修复的问题自动处理**
- 方案切换策略
- 常见问题速查表

---

## 高级模块详情

### [09 - JS逆向模块](skills/09-js-reverse.md) 🔬 深度逆向
> JavaScript 深度逆向工程

- **Chrome DevTools 断点调试**
- **AST 反混淆技术**
- **Webpack 模块提取**
- 算法特征识别 (MD5/SHA/HMAC/AES)
- 补环境 (jsdom/vm2)
- RPC 远程调用
- 京东 h5st 完整逆向案例

### [10 - 验证码模块](skills/10-captcha.md) 🤖 验证码破解
> 各类验证码识别与绕过

- **滑块验证码** (Canny边缘检测 + Bezier轨迹)
- **点选验证码** (OCR + YOLO目标检测)
- **图形验证码** (ddddocr/第三方平台)
- reCAPTCHA v2/v3 处理
- hCaptcha 处理
- 极验/网易易盾/腾讯防水墙

### [11 - 指纹工厂](skills/11-fingerprint.md) 🎭 指纹伪装
> 浏览器指纹生成与管理

- **完整指纹结构** (Navigator/Screen/WebGL/Canvas/Audio)
- **指纹生成器** (一致性保证)
- **指纹注入** (Playwright/Selenium)
- 指纹持久化与轮换
- 检测对抗技术
- 在线检测站点测试

### [12 - 移动端模块](skills/12-mobile.md) 📱 APP逆向
> 移动应用抓包与逆向

- **mitmproxy 抓包配置**
- **SSL Pinning 绕过**
- **Frida 动态 Hook**
- APK/IPA 反编译
- Native 库分析
- 模拟器自动化 (Appium/ADB)
- 设备指纹伪造

### [13 - 分布式模块](skills/13-distributed.md) 🌐 集群架构
> 分布式爬虫架构设计

- **主从架构** (Master-Worker)
- **Celery 任务队列**
- **Scrapy-Redis 分布式**
- 消息队列 (RabbitMQ/Kafka)
- Bloom Filter 去重
- 分布式锁
- 数据分片与同步
- 断点续爬

### [14 - 监控模块](skills/14-monitoring.md) 📊 可视化监控
> 监控、告警与可视化

- **Prometheus 指标采集**
- **Grafana 仪表盘**
- **结构化日志** (JSON/Loki)
- 告警规则引擎
- 多渠道通知 (钉钉/飞书/邮件/Telegram)
- 健康检查 (K8s探针)
- OpenTelemetry 链路追踪

### [15 - 数据安全模块](skills/15-compliance.md) 🔐 数据安全
> PII脱敏与密钥管理

- **PII 检测与自动脱敏** (手机/邮箱/身份证/银行卡)
- **密钥加密存储** (Fernet 对称加密)
- **凭证自动轮换** (OAuth Token 等)
- 数据保留策略

### [16 - 战术决策模块](skills/16-tactics.md) 🎯 实战决策
> 入口发现、策略匹配、动态调整

- **入口发现** (API > 移动端 > H5 > PC)
- **策略匹配** (根据目标特征选择最优方案)
- **蜜罐检测** (识别假算法/钓鱼接口)
- **风险评估** (封禁预警/暴露程度)
- **动态调整** (失败自动切换策略)
- 参数微调 (根据执行情况调整)

### [17 - 反馈循环模块](skills/17-feedback-loop.md) 🔄 自主进化
> 决策追踪、数据验证、经验沉淀

- **决策日志** (每个决策可追溯)
- **数据验证** (禁止伪造数据)
- **知识库** (经验积累与复用)
- **反馈控制器** (自动调整策略)

### [18 - 决策总控模块](skills/18-brain-controller.md) 🧠 大脑中枢
> 任务理解、模块协调、执行编排

- **任务类型识别** (明确/模糊/求助/咨询)
- **模块选择决策表** (特征→模块映射)
- **执行流程编排** (标准化流程)
- **异常处理入口** (故障触发决策)
- **用户交互指南** (何时询问/何时自决)

### [19 - 故障决策树模块](skills/19-fault-decision-tree.md) 🚨 故障处理
> 故障分类、决策路径、自动恢复

- **网络层故障** (超时/DNS/SSL/代理)
- **HTTP层故障** (4xx/5xx 处理)
- **反爬层故障** (验证码/IP封禁/行为检测)
- **数据层故障** (定位失败/格式变化/内容为空)
- **浏览器层故障** (崩溃/内存/资源加载)
- **故障升级流程** (自动→诊断→策略→人工)

### [20 - 端到端案例库](skills/20-e2e-cases.md) 📚 实战指南
> 完整实战案例、可复制方案

- **简单案例** (静态页面/公开API/表单登录)
- **中等案例** (Cookie验证/简单签名/验证码/动态加载)
- **困难案例** (京东h5st/Cloudflare/多因素认证)
- **特殊案例** (WebSocket/GraphQL/APP抓取/小程序)

### [21 - 反面教材库](skills/21-anti-patterns.md) ⛔ 避坑指南
> 禁止行为、常见错误、失败案例

- **红线行为** (伪造数据/忽略错误/无限重试)
- **常见错误** (频率过高/不检查响应/硬编码选择器)
- **失败案例** (签名猜测/Cookie误判/反爬低估)
- **检查清单** (开始前/编码时/运行时)

### [22 - 知识沉淀格式](skills/22-knowledge-format.md) 📝 经验积累
> 经验沉淀规范、知识检索、持续进化

- **网站知识** (反爬特征/签名算法/有效策略)
- **技术知识** (问题解决/工具使用)
- **决策知识** (场景判断/方案选择)
- **错误知识** (失败原因/修复方法)
- **知识检索** (索引/查询/复用)

### [23 - MCP协议模块](skills/23-mcp-protocol.md) 🔌 对外接口
> 工具清单、参数规范、安全边界

- **工具定义** (scrape_page/analyze_site等)
- **参数Schema** (JSON Schema规范)
- **响应格式** (标准化envelope)
- **安全边界** (权限/速率/黑名单)

### [24 - 凭据池模块](skills/24-credential-pool.md) 🔑 账号管理
> 账号池、会话刷新、挑战处理

- **凭据类型** (账号/会话/Token/设备)
- **池化管理** (分配/轮换/冷却)
- **会话生命周期** (刷新/过期/封禁)
- **挑战处理** (验证码/二次验证)

### [25 - 数据Schema模块](skills/25-data-schema.md) 📋 数据质量
> Schema定义、校验去重、落库适配

- **Schema定义** (字段类型/规则/版本)
- **数据校验** (类型/范围/模式)
- **增量去重** (唯一键/内容哈希)
- **存储适配** (JSON/SQLite/数据库)

### [26 - 测试回归模块](skills/26-testing-regression.md) 🧪 质量门禁
> 测试体系、基准指标、CI门禁

- **测试分层** (单元/集成/E2E)
- **性能基准** (响应时间/吞吐量)
- **回归检查** (功能/性能回归)
- **红线门禁** (安全/数据/行为红线)

---

## 预设网站配置

| 网站 | 反爬等级 | 关键模块 |
|------|---------|---------|
| 京东 | ⚫ Extreme | 签名(h5st) + 反检测 |
| 淘宝 | ⚫ Extreme | 签名(mtop) + 反检测 |
| 抖音 | ⚫ Extreme | 签名(X-Bogus) + 反检测 |
| 小红书 | 🔴 High | 签名(X-s) + 反检测 |
| 拼多多 | 🔴 High | 签名(anti-content) |
| 哔哩哔哩 | 🟡 Medium | 签名(wbi) |
| 知乎 | 🟡 Medium | 签名(x-zse-96) |
| 微博 | 🔴 High | 登录态 + 反检测 |
| 当当 | 🟢 Low | 基础请求 |
| 苏宁 | 🟡 Medium | 签名 |

---

## 版本历史

| 版本 | 日期 | 变更 |
|------|------|------|
| 3.4.0 | 2026-01 | 新增基础设施层：MCP协议(23)、凭据池(24)、数据Schema(25)、测试回归(26)；统一文档模板(00-skill-template)；新增技能矩阵(SKILL-MATRIX.md) |
| 3.3.0 | 2026-01 | 新增实战指南：端到端案例(20)、反面教材(21)、知识格式(22) |
| 3.2.0 | 2026-01 | 新增自主进化层：反馈循环(17)、决策总控(18)、故障决策树(19) |
| 3.1.0 | 2026-01 | 新增战术决策模块(16)，精简数据安全模块(15) |
| 3.0.0 | 2026-01 | 专家级升级：新增7个高级模块 (JS逆向/验证码/指纹/移动端/分布式/监控/合规) |
| 2.0.0 | 2026-01 | 模块化重构 |
| 1.0.0 | 2025-12 | 初始版本 |

---

## 模块依赖关系

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           模块依赖图                                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │                         核心层                                        │ │
│   │    00-快速开始 ──▶ 01-侦查 ──▶ 02-反检测 ──▶ 03-签名              │ │
│   │                        │           │            │                    │ │
│   │                        ▼           ▼            ▼                    │ │
│   │                   04-请求 ◀── 11-指纹 ◀── 09-JS逆向                 │ │
│   │                        │                                             │ │
│   │                        ▼                                             │ │
│   │              05-解析 ──▶ 06-存储 ◀── 13-分布式                      │ │
│   │                   │                       │                          │ │
│   │                   ▼                       ▼                          │ │
│   │              07-调度 ◀─────────────── 14-监控                       │ │
│   │                   │                                                  │ │
│   │                   ▼                                                  │ │
│   │              08-诊断 ◀── 10-验证码                                  │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │                         决策层                                        │ │
│   │    16-战术 ──▶ 入口发现 ──▶ 策略选择 ──▶ 动态调整                  │ │
│   │       ▲           │            │            │                        │ │
│   │       └───────────┴────────────┴────────────┘ (贯穿全流程)           │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │                        自主进化层                                     │ │
│   │                                                                      │ │
│   │   ┌────────────┐    ┌────────────┐    ┌────────────┐               │ │
│   │   │ 18-总控    │───▶│ 19-故障树  │◀──▶│ 17-反馈    │               │ │
│   │   │ (大脑)     │    │ (应对)     │    │ (学习)     │               │ │
│   │   └─────┬──────┘    └────────────┘    └─────┬──────┘               │ │
│   │         │                                    │                       │ │
│   │         └────────── 协调所有模块 ────────────┘                       │ │
│   │                                                                      │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │                        知识沉淀层                                     │ │
│   │                                                                      │ │
│   │   ┌────────────┐    ┌────────────┐    ┌────────────┐               │ │
│   │   │ 20-案例库  │───▶│ 22-知识    │◀───│ 21-反模式  │               │ │
│   │   │ (学习)     │    │ (沉淀)     │    │ (避坑)     │               │ │
│   │   └────────────┘    └────────────┘    └────────────┘               │ │
│   │                                                                      │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
│   ┌──────────────────────────────────────────────────────────────────────┐ │
│   │                         专业层                                        │ │
│   │    12-移动端 (独立/可选)        15-数据安全 (全局约束)               │ │
│   └──────────────────────────────────────────────────────────────────────┘ │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

