========================================================================
                    代理优化配置说明
========================================================================

一、你的代理实际情况
========================================================================

根据代理服务商统计：
  - 限制: 1秒5次请求
  - 成功率: 34% (66%请求会失败)
  - 连接速度: 较慢


二、已做的优化配置
========================================================================

【优化 1】增加请求延迟
--------------------------------------------------------
  修改前: 2-5 秒
  修改后: 3-6 秒

  原因: 避免超过 1秒5次 的限制
  位置: unified_agent/scraper/jd_comments.py


【优化 2】增加重试次数
--------------------------------------------------------
  修改前: 3 次
  修改后: 5 次

  原因: 应对 66% 的失败率
  计算: 5次重试 → 成功概率约 87%


【优化 3】延长超时时间
--------------------------------------------------------
  修改前: 30-60 秒
  修改后: 120 秒 (2分钟)

  原因: 代理转发慢，需要更长等待时间
  影响页面: 登录页、首页、搜索页


【优化 4】使用 domcontentloaded
--------------------------------------------------------
  修改前: networkidle (等待网络完全空闲)
  修改后: domcontentloaded (DOM加载完成即可)

  原因: 通过代理时网络永远不会完全空闲
  效果: 更快的页面判断


【优化 5】增加稳定等待
--------------------------------------------------------
  在关键页面加载后增加 3-5 秒等待

  原因: 确保页面JS执行完成
  位置: 首页、登录页、搜索页


【优化 6】启用代理
--------------------------------------------------------
  .env 文件: PROXY_ENABLED=true

  配置:
    主机: e927.kdltps.com
    端口: 15818
    用户: t16960353841632


三、预期效果
========================================================================

测试模式 (120条数据):
  - 预计时间: 5-10 分钟
  - 成功率: 约 87% (经过5次重试)
  - 可能出现: 多次重试提示

正式模式 (15000条数据):
  - 预计时间: 1-2 小时
  - 总请求数: 约 3000-5000 次
  - 实际成功: 2000-3000 次 (其他重试)


四、运行方式
========================================================================

双击运行: 【优化代理】测试运行.bat

你会看到:
  1. 浏览器启动（稍慢，因为代理）
  2. 登录页加载（稍慢）
  3. 开始爬取
  4. 可能出现重试提示：
     [诊断] timeout -> 网络超时
     [恢复] 执行: ['wait', 'retry']
     [OK] 恢复成功

这是正常的！因为代理有66%失败率。


五、风险提示
========================================================================

【可能遇到的问题】

问题 1: 连续失败 5 次
  现象: "连续错误5次，跳过此商品"
  原因: 代理完全失败
  解决: 自动跳过，继续下一个

问题 2: 总是超时
  现象: "Page.goto: Timeout"
  原因: 代理太慢
  解决: 已延长到2分钟，如果还超时说明代理有问题

问题 3: 数据不完整
  现象: 只爬到部分数据
  原因: 多次失败后跳过
  解决: 重新运行爬取缺失的品牌

问题 4: 速度很慢
  现象: 比预期慢很多
  原因: 代理慢 + 失败重试
  解决: 正常现象，耐心等待


【建议】

如果测试成功:
  ✓ 可以继续用这个代理完成作业
  ✓ 但要有耐心，速度会很慢
  ✓ 可能需要多次运行才能收集完整数据

如果频繁失败:
  ✗ 建议更换代理服务商
  ✗ 选择成功率 > 90% 的代理
  ✗ 或者联系当前代理服务商解决问题


六、监控指标
========================================================================

运行时注意观察:

  成功指标:
    ✓ 页面能加载（即使慢）
    ✓ Cookie 能保存
    ✓ 商品能搜索到
    ✓ 评论能获取（即使有重试）

  失败指标:
    ✗ 连续超时
    ✗ 连续失败 > 5 次
    ✗ 完全无法加载页面
    ✗ 大量商品被跳过


七、立即行动
========================================================================

步骤 1: 双击 "【优化代理】测试运行.bat"

步骤 2: 观察日志输出
  - 是否能启动浏览器
  - 是否能加载登录页
  - 是否能登录成功

步骤 3: 登录京东
  - 手动扫码或输入密码
  - 等待跳转

步骤 4: 观察爬取过程
  - 是否能搜索商品
  - 是否能获取评论
  - 重试是否成功

步骤 5: 查看结果
  - 检查 data/jd_ac_comments.csv
  - 确认数据量
  - 查看日志统计


========================================================================
                    现在开始测试
========================================================================

双击: 【优化代理】测试运行.bat

预期过程:
  1. 启动较慢（代理转发）
  2. 可能有超时重试（正常）
  3. 逐步收集数据
  4. 最终完成

保持耐心，不要关闭浏览器！
========================================================================
